#!/bin/bash

###############################################
# Claude Code ç®€åŒ–å¯åŠ¨è„šæœ¬
# ç›´æ¥è¿è¡Œï¼Œè¾“å‡ºå®æ—¶æ˜¾ç¤º
###############################################

cd "$(dirname "$0")"

echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘   ğŸ¤– Claude Code ç®€åŒ–å¯åŠ¨å™¨              â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""

# æ£€æŸ¥ç¯å¢ƒ
if ! command -v claude &> /dev/null; then
    echo "âŒ æ‰¾ä¸åˆ° claude å‘½ä»¤"
    exit 1
fi

# ç”Ÿæˆä»»åŠ¡
echo "ğŸ“ ç”Ÿæˆä»»åŠ¡..."
python3 smart_task_generator.py > CURRENT_TASK.md
echo "âœ… ä»»åŠ¡å·²ç”Ÿæˆ"
echo ""

# æ˜¾ç¤ºå½“å‰çŠ¶æ€
if [ -f "tools/progress.json" ]; then
    current=$(python3 -c "import json; print(json.load(open('tools/progress.json'))['current_chapter'])" 2>/dev/null || echo "0")
    echo "ğŸ“Š å½“å‰è¿›åº¦: ç¬¬ ${current}/1694 ç« "
    echo ""
fi

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "       Claude Code å¼€å§‹æ‰§è¡Œ"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""

# ç›´æ¥è¿è¡Œï¼Œå®æ—¶è¾“å‡º
# ä½¿ç”¨ unbuffered æ–¹å¼
echo "ä½ ç°åœ¨æ˜¯å®Œå…¨è‡ªåŠ¨åŒ–æ¨¡å¼ã€‚è¯·ä¸¥æ ¼æ‰§è¡Œ CURRENT_TASK.md ä¸­çš„ä»»åŠ¡ã€‚
è‡ªåŠ¨æ‰§è¡Œæ‰€æœ‰æ­¥éª¤ï¼Œä¸è¦ç­‰å¾…ç¡®è®¤ï¼Œå®Œæˆåè‡ªåŠ¨æäº¤ Gitã€‚" | \
    claude --permission-mode bypassPermissions

echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "       æ‰§è¡Œå®Œæˆ"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""

# æ˜¾ç¤ºç»“æœ
if [ -f "tools/progress.json" ]; then
    current=$(python3 -c "import json; print(json.load(open('tools/progress.json'))['current_chapter'])" 2>/dev/null || echo "0")
    echo "ğŸ“Š æœ€æ–°è¿›åº¦: ç¬¬ ${current}/1694 ç« "
fi

echo ""
echo "âœ… å®Œæˆï¼"
