# 文字游戏生成工作流程

## 概述

本框架用于将长篇小说转化为可交互的文字冒险游戏。整个流程分为多个阶段，每个阶段有专门的Agent负责。

## 工作流程图

```
┌─────────────────────────────────────────────────────────────────────┐
│                        第一阶段：小说分析                              │
├─────────────────────────────────────────────────────────────────────┤
│  [小说文本] → [分块读取(3000字/次)] → [累积总结] → [全局理解]          │
│                         ↓                                           │
│              ┌─────────┴─────────┐                                  │
│              ↓                   ↓                                  │
│       [世界观提取器]        [角色分析器]                              │
│              ↓                   ↓                                  │
│       世界设定文档           角色档案库                               │
└─────────────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────────────┐
│                        第二阶段：游戏设计                              │
├─────────────────────────────────────────────────────────────────────┤
│  [剧情设计器] ← 世界设定 + 角色档案 + 原著剧情                         │
│       ↓                                                             │
│  分析剧情复杂度 → 确定结局数量 → 设计分支节点                          │
│       ↓                                                             │
│  [世界线收束设计] → 确定收束点 → 保证剧情不发散                        │
│       ↓                                                             │
│  [属性系统设计] → 根据世界观设计属性                                   │
│       ↓                                                             │
│  [物品道具设计] → 设计背包物品                                        │
│       ↓                                                             │
│  [探索系统设计] → 设计可探索区域                                      │
└─────────────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────────────┐
│                        第三阶段：数据生成                              │
├─────────────────────────────────────────────────────────────────────┤
│  将设计转化为JSON数据结构，填充到游戏引擎中                             │
└─────────────────────────────────────────────────────────────────────┘

## 分块处理策略（针对1000万字级别小说）

### 读取策略
- 每次读取3000字
- 每次读取后生成「片段摘要」
- 每10个片段生成「章节总结」
- 每10个章节生成「卷/部分总结」
- 最终生成「全书概要」

### 累积上下文结构
```json
{
  "当前进度": {
    "已读字数": 0,
    "当前位置": "第X章",
    "完成百分比": 0
  },
  "累积理解": {
    "世界观要素": [],
    "主要角色": [],
    "核心剧情线": [],
    "已发现的分支可能": []
  },
  "临时缓存": {
    "最近10个片段摘要": [],
    "当前章节内容": ""
  }
}
```

### Agent运行循环

```
while 未读完小说:
    1. 读取3000字
    2. 调用「小说分析器」生成片段摘要
    3. 更新累积理解
    4. if 片段数 % 10 == 0:
           生成章节总结
           调用「世界观提取器」更新世界设定
           调用「角色分析器」更新角色档案
    5. if 章节数 % 10 == 0:
           生成卷总结
           调用「剧情设计器」初步规划分支
           
读完后:
    1. 生成全书概要
    2. 调用「世界线收束设计」确定收束点
    3. 调用「属性系统设计」确定属性体系
    4. 调用「物品道具设计」设计物品系统
    5. 调用「探索系统设计」设计探索内容
    6. 生成最终游戏数据
```

## 数据流

```
小说TXT
    ↓
片段摘要 × N → 章节总结 × M → 卷总结 × K → 全书概要
    ↓              ↓              ↓            ↓
  细节提取      情节梳理      主线确认     框架定型
    ↓              ↓              ↓            ↓
角色细节档案  场景事件库    剧情分支树   游戏整体设计
    ↓              ↓              ↓            ↓
    └──────────────┴──────────────┴────────────┘
                        ↓
                  game_data.json
                        ↓
                    游戏运行
```

## 文件输出

分析完成后生成以下文件：

1. `world_setting.json` - 世界观设定
2. `characters.json` - 角色档案
3. `story_tree.json` - 剧情树
4. `convergence_points.json` - 收束点
5. `attributes.json` - 属性系统
6. `items.json` - 物品系统
7. `exploration.json` - 探索区域
8. `game_config.json` - 游戏配置
